<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurateur TBM Daher</title>
    <meta name="description" content="Configurateur web pour visualiser les rendus TBM">
    <meta name="author" content="Configurateur Daher">

    <!-- Styles CSS -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/viewport.css">
    <link rel="stylesheet" href="styles/controls.css">
    <link rel="stylesheet" href="styles/animations.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <h1>Configurateur TBM Daher</h1>
        <p class="app-subtitle">Configurez et visualisez votre avion TBM en temps r√©el</p>
        <!-- BUG-003 FIX: Badge indicateur de connexion -->
        <div class="connection-badge" id="connectionBadge">
            <span class="badge-dot"></span>
            <span class="badge-text">En ligne</span>
        </div>
    </header>

    <!-- Main Container (Grid 2 colonnes) -->
    <main class="app-container">
        <!-- Section Viewport (Gauche) -->
        <section class="viewport-section" id="viewportSection">
            <div class="viewport-container">
                <!-- Section Donn√©es Techniques (en haut sur une ligne) -->
                <div class="technical-controls">
                    <!-- US-019 : S√©lection Base de Donn√©es -->
                    <div class="form-group">
                        <label for="selectDatabase">Base de donn√©es</label>
                        <select id="selectDatabase" name="database" class="form-control">
                            <option value="" disabled selected>Chargement...</option>
                            <!-- Options ajout√©es dynamiquement par JS -->
                        </select>
                    </div>

                    <!-- Dimensions Image -->
                    <div class="form-group">
                        <label>Dimensions Image</label>
                        <div class="dimensions-group">
                            <input
                                type="number"
                                id="inputWidth"
                                name="imageWidth"
                                class="form-control"
                                placeholder="1920"
                                value="1920"
                                min="100"
                                max="10000"
                            >
                            <span>√ó</span>
                            <input
                                type="number"
                                id="inputHeight"
                                name="imageHeight"
                                class="form-control"
                                placeholder="1080"
                                value="1080"
                                min="100"
                                max="10000"
                            >
                        </div>
                    </div>

                    <!-- US-021 : T√©l√©chargement JSON -->
                    <div class="form-group">
                        <button type="button" class="btn btn-download" id="btnDownloadJSON" title="T√©l√©charger la configuration JSON">
                            ‚¨á Download JSON
                        </button>
                    </div>

                    <!-- US-032 : T√©l√©chargement multiple d'images -->
                    <div class="form-group">
                        <button type="button" class="btn btn-secondary" id="btnBulkDownload" title="T√©l√©charger plusieurs images">
                            üì• T√©l√©charger plusieurs images
                        </button>
                    </div>
                </div>

                <div class="viewport-header">
                    <h2>Aper√ßu</h2>
                    <!-- S√©lecteur de vue Ext/Int -->
                    <div class="view-selector">
                        <div class="toggle-group">
                            <button type="button" class="toggle-btn active" id="btnViewExterior" data-view="exterior">
                                Ext√©rieur
                            </button>
                            <button type="button" class="toggle-btn" id="btnViewInterior" data-view="interior">
                                Int√©rieur
                            </button>
                        </div>
                    </div>
                    <div class="viewport-actions">
                        <button class="btn btn-icon" id="btnFullscreen" title="Plein √©cran">
                            <span class="icon-fullscreen">‚õ∂</span>
                        </button>
                    </div>
                </div>

                <!-- Zone d'affichage des images (mosa√Øque) -->
                <div class="viewport-display" id="viewportDisplay">
                    <div class="viewport-placeholder">
                        <p>S√©lectionnez une configuration pour g√©n√©rer le rendu</p>
                    </div>

                    <!-- Loader (cach√© par d√©faut) -->
                    <div class="viewport-loader hidden" id="viewportLoader">
                        <div class="spinner"></div>
                        <p>G√©n√©ration en cours...</p>
                    </div>

                    <!-- Message d'erreur (cach√© par d√©faut) -->
                    <div class="viewport-error hidden" id="viewportError">
                        <p class="error-message"></p>
                        <button class="btn-retry" id="btnRetry">R√©essayer</button>
                    </div>

                    <!-- US-032 : Contr√¥les mode s√©lection -->
                    <div id="selectionControls" class="selection-controls hidden">
                        <span id="selectionCounter" class="selection-counter">0 images s√©lectionn√©es</span>
                        <button type="button" id="btnDownloadSelected" class="btn btn-primary" disabled>
                            T√©l√©charger la s√©lection (0)
                        </button>
                        <button type="button" id="btnCancelSelection" class="btn btn-secondary">
                            Annuler
                        </button>
                    </div>

                    <!-- US-032 : Barre de progression t√©l√©chargement -->
                    <div id="downloadProgress" class="download-progress hidden">
                        <p id="downloadStatus">T√©l√©chargement en cours...</p>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Mosa√Øque d'images (ajout√© dynamiquement par JS) -->
                    <div class="mosaic-grid hidden" id="mosaicGrid">
                        <!-- Images ajout√©es dynamiquement par renderMosaic() -->
                    </div>
                </div>

                <!-- Actions contextuelles sous la mosa√Øque -->
                <div class="viewport-actions-panel">
                    <!-- Actions EXT√âRIEUR : D√©cor + Portes -->
                    <div id="actions-exterior" class="actions-section">
                        <div class="form-group">
                            <label for="selectDecor">D√©cor</label>
                            <select id="selectDecor" name="decor" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label>Porte pilote</label>
                            <div class="toggle-group">
                                <button type="button" class="toggle-btn active" id="btnDoorPilotClosed" data-value="Closed">Ferm√©e</button>
                                <button type="button" class="toggle-btn" id="btnDoorPilotOpen" data-value="Open">Ouverte</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Porte passager</label>
                            <div class="toggle-group">
                                <button type="button" class="toggle-btn active" id="btnDoorPassengerClosed" data-value="Closed">Ferm√©e</button>
                                <button type="button" class="toggle-btn" id="btnDoorPassengerOpen" data-value="Open">Ouverte</button>
                            </div>
                        </div>
                    </div>

                    <!-- Actions INT√âRIEUR : Accessoires -->
                    <div id="actions-interior" class="actions-section" style="display: none;">
                        <div class="form-group">
                            <label>Volet Hublots</label>
                            <div class="toggle-group">
                                <button type="button" class="toggle-btn active" id="btnSunGlassOFF" data-value="SunGlassOFF">OFF</button>
                                <button type="button" class="toggle-btn" id="btnSunGlassON" data-value="SunGlassON">ON</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Tablette</label>
                            <div class="toggle-group">
                                <button type="button" class="toggle-btn active" id="btnTabletClosed" data-value="Closed">Ferm√©e</button>
                                <button type="button" class="toggle-btn" id="btnTabletOpen" data-value="Open">Ouverte</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Controls (Droite) -->
        <aside class="controls-section" id="controlsSection">
            <div class="controls-container">
                <!-- US-028 : Affichage conditionnel selon vue (Ext√©rieur / Int√©rieur) -->

                <!-- SECTION EXT√âRIEUR (visible par d√©faut) -->
                <div id="controls-exterior" class="controls-view-section">
                    <!-- Accord√©on Ext√©rieur -->

                    <!-- 1. Avion -->
                    <div class="accordion-section active">
                        <div class="accordion-header">
                            <span>Avion</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="form-group">
                                <label for="selectVersion">Mod√®le</label>
                                <select id="selectVersion" name="version" class="form-control"></select>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Peinture -->
                    <div class="accordion-section">
                        <div class="accordion-header">
                            <span>Peinture</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="form-group">
                                <label for="selectPaintScheme">Sch√©ma</label>
                                <select id="selectPaintScheme" name="paintScheme" class="form-control"></select>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Zones Personnalis√©es -->
                    <div class="accordion-section">
                        <div class="accordion-header">
                            <span>Zones Personnalis√©es</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <!-- Zone A -->
                            <div class="form-group">
                                <label for="selectZoneA">Zone A</label>
                                <input
                                    type="text"
                                    id="searchZoneA"
                                    class="form-control search-input"
                                    placeholder="Rechercher..."
                                    autocomplete="off"
                                >
                                <select id="selectZoneA" name="zoneA" class="form-control"></select>
                            </div>

                            <!-- Zone B -->
                            <div class="form-group">
                                <label for="selectZoneB">Zone B</label>
                                <input
                                    type="text"
                                    id="searchZoneB"
                                    class="form-control search-input"
                                    placeholder="Rechercher..."
                                    autocomplete="off"
                                >
                                <select id="selectZoneB" name="zoneB" class="form-control"></select>
                            </div>

                            <!-- Zone C -->
                            <div class="form-group">
                                <label for="selectZoneC">Zone C</label>
                                <input
                                    type="text"
                                    id="searchZoneC"
                                    class="form-control search-input"
                                    placeholder="Rechercher..."
                                    autocomplete="off"
                                >
                                <select id="selectZoneC" name="zoneC" class="form-control"></select>
                            </div>

                            <!-- Zone D -->
                            <div class="form-group">
                                <label for="selectZoneD">Zone D</label>
                                <input
                                    type="text"
                                    id="searchZoneD"
                                    class="form-control search-input"
                                    placeholder="Rechercher..."
                                    autocomplete="off"
                                >
                                <select id="selectZoneD" name="zoneD" class="form-control"></select>
                            </div>

                            <!-- Zone A+ -->
                            <div class="form-group">
                                <label for="selectZoneAPlus">Zone A+</label>
                                <input
                                    type="text"
                                    id="searchZoneAPlus"
                                    class="form-control search-input"
                                    placeholder="Rechercher..."
                                    autocomplete="off"
                                >
                                <select id="selectZoneAPlus" name="zoneAPlus" class="form-control"></select>
                            </div>
                        </div>
                    </div>

                    <!-- 4. H√©lice -->
                    <div class="accordion-section">
                        <div class="accordion-header">
                            <span>H√©lice</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="form-group">
                                <label for="selectSpinner">Finition</label>
                                <select id="selectSpinner" name="spinner" class="form-control"></select>
                            </div>
                        </div>
                    </div>

                    <!-- 5. Immatriculation -->
                    <div class="accordion-section">
                        <div class="accordion-header">
                            <span>Immatriculation</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="form-group">
                                <label for="inputImmat">Num√©ro</label>
                                <div class="input-group">
                                    <input type="text" id="inputImmat" name="immat" class="form-control" maxlength="6" placeholder="N960TB" value="N960TB">
                                    <button type="button" class="btn btn-primary" id="btnSubmitImmat">Envoyer</button>
                                </div>
                                <span class="form-error hidden" id="errorImmat">Maximum 6 caract√®res alphanum√©riques</span>
                            </div>
                            <div class="form-group">
                                <label>Type Police</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="fontType" value="slanted" id="radioSlanted" checked>
                                        <span>Slanted</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="fontType" value="straight" id="radioStraight">
                                        <span>Straight</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="selectStyle">Style</label>
                                <select id="selectStyle" name="style" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION INT√âRIEUR (masqu√©e par d√©faut) -->
                <div id="controls-interior" class="controls-view-section" style="display: none;">
                    <!-- Accord√©on Int√©rieur -->

                    <!-- 1. Prestige -->
                    <div class="accordion-section active">
                        <div class="accordion-header">
                            <span>Prestige</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="form-group">
                                <label for="selectPrestige">Collection</label>
                                <select id="selectPrestige" name="prestige" class="form-control"></select>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Si√®ges -->
                    <div class="accordion-section">
                        <div class="accordion-header">
                            <span>Si√®ges</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <!-- US-035 : Ordre r√©organis√© -->
                            <!-- 1. Cuir des si√®ges -->
                            <div class="form-group">
                                <label for="seat-covers">Cuir des si√®ges</label>
                                <select id="seat-covers" class="form-control"></select>
                            </div>
                            <!-- 2. Ultra-Suede Ribbon (d√©plac√© de Mat√©riaux) -->
                            <div class="form-group">
                                <label for="ultra-suede-ribbon">Ruban Ultra-Suede</label>
                                <select id="ultra-suede-ribbon" class="form-control"></select>
                            </div>
                            <!-- 3. Stitching (US-036) -->
                            <div class="form-group">
                                <label for="stitching">Stitching</label>
                                <select id="stitching" class="form-control"></select>
                            </div>
                            <!-- 4. Mat√©riau Central -->
                            <div class="form-group">
                                <label for="central-seat-material">Mat√©riau central</label>
                                <select id="central-seat-material" class="form-control"></select>
                            </div>
                            <!-- 5. Perforation des si√®ges -->
                            <div class="form-group">
                                <label>Perforation des si√®ges</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="perforated-seat" value="NoSeatPerforation_Premium" checked>
                                        <span>OFF</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="perforated-seat" value="SeatCenterPerforation_Premium">
                                        <span>ON</span>
                                    </label>
                                </div>
                            </div>
                            <!-- 6. Ceintures (d√©plac√© apr√®s Perforation) -->
                            <div class="form-group">
                                <label for="seatbelts">Ceintures</label>
                                <select id="seatbelts" class="form-control"></select>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Mat√©riaux -->
                    <div class="accordion-section">
                        <div class="accordion-header">
                            <span>Mat√©riaux</span>
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="form-group">
                                <label for="carpet">Tapis</label>
                                <select id="carpet" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label for="tablet-finish">Bois tablette</label>
                                <select id="tablet-finish" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label for="metal-finish">Finition m√©tal</label>
                                <select id="metal-finish" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label for="upper-side-panel">Panneau sup√©rieur</label>
                                <select id="upper-side-panel" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label for="lower-side-panel">Panneau inf√©rieur</label>
                                <select id="lower-side-panel" class="form-control"></select>
                            </div>
                            <!-- US-035 : Ultra-Suede Ribbon d√©plac√© vers section Si√®ges -->
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
        <p>&copy; 2025 Configurateur TBM Daher - Version 1.0</p>
        <p>G√©n√©r√© avec l'API Lumiscaphe</p>
    </footer>

    <!-- US-020 : Modal plein √©cran -->
    <div class="fullscreen-modal hidden" id="fullscreenModal">
        <div class="fullscreen-backdrop" id="fullscreenBackdrop"></div>
        <div class="fullscreen-content">
            <button class="fullscreen-close" id="fullscreenClose">‚úï</button>
            <button class="fullscreen-nav fullscreen-prev" id="fullscreenPrev">
                <span>‚Äπ</span>
            </button>
            <img class="fullscreen-image" id="fullscreenImage" src="" alt="Image plein √©cran">
            <button class="fullscreen-nav fullscreen-next" id="fullscreenNext">
                <span>‚Ä∫</span>
            </button>
            <div class="fullscreen-counter" id="fullscreenCounter">1 / 1</div>
        </div>
    </div>

    <!-- Scripts JS (modules ES6) -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
